
## The StarConsumers Capabilities

StarConsumers is a Python framework designed for building Google Cloud Pub/Sub message consumers with a focus on scalability, observability, and ease of use. The framework follows a decorator-based approach similar to FastAPI for defining message handlers.

### Message Consumer Management

The framework provides a `TopicConsumer` class that allows developers to:
- Define message handlers using decorators with the `@consumer.task()` syntax
- Configure subscription parameters including dead letter policies, retry policies, and message ordering
- Support both synchronous and asynchronous message handlers
- Automatically create and update Pub/Sub subscriptions with lifecycle management

### Application Orchestration

The `StarConsumers` main application class offers:
- Multi-consumer support - can register multiple topic consumers
- Task activation control - can selectively run specific tasks by name
- Process management using multiprocessing with spawn method
- FastAPI integration providing health check endpoints at `/health`
- Graceful startup and shutdown lifecycle management

### Middleware System

The framework includes a comprehensive middleware system:
- Global and local middleware support (applied at application and consumer levels)
- Built-in middlewares for APM transaction tracking, logging context, exception handling, and message serialization
- Custom middleware support through the `MessageMiddleware` base class
- Middleware chain building with proper ordering and dependency injection

### Publisher Capabilities

The `PubSubPublisher` class provides:
- Topic creation with automatic handling of existing topics
- Message publishing with support for attributes and ordering keys
- Distributed tracing integration for message correlation
- JSON serialization of message data

### Subscriber Management

The `PubSubSubscriber` class handles:
- Subscription creation and updates with comprehensive configuration
- Flow control for message batching and rate limiting
- Dead letter topic support with configurable retry attempts
- Message filtering and exactly-once delivery options
- Graceful shutdown and error handling

### Process Management and Monitoring

The framework includes robust process management:
- Multi-process architecture with one process per subscription
- Process health monitoring and connection tracking
- APM (Application Performance Monitoring) integration
- Resource usage monitoring using psutil
- Graceful process termination with timeout handling

### Observability and Logging

Built-in observability features include:
- Structured logging with contextual information (trace IDs, span IDs, message IDs)
- APM provider integration for distributed tracing
- Exception handling with proper logging and message acknowledgment
- Health check endpoints for monitoring system status

### Configuration and Deployment

The framework supports:
- Environment-based configuration
- Docker deployment with provided docker-compose setup
- Google Cloud Pub/Sub emulator support for local development
- Credential management and validation

### Message Processing Features

Key message processing capabilities:
- Automatic message acknowledgment/negative acknowledgment based on handler success
- Support for DROP and RETRY exceptions for fine-grained message flow control
- Message serialization into structured `TopicMessage` objects
- Delivery attempt tracking and dead letter queue integration
- Message ordering and exactly-once delivery support

