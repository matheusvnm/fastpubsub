# Getting Started

## What is FastPubSub

FastPubSub is a modern, high-performance framework for building applications that process event messages on Google PubSub. It is built on top of FastAPI, Pydantic, and the standard Google PubSub Python SDK to provide an easy-to-use and intuitive development experience.

FastPubSub is designed to simplify the development of Pub/Sub consumers by handling the complexities of asynchronous message processing. It provides a simple and intuitive way to define subscribers and publishers, allowing you to focus on your application's business logic.

FastPubSub uses the pull subscription model to receive messages from Pub/Sub. This means that the application actively polls for new messages from the subscription. This is the most common and flexible way to consume messages from Pub/Sub.


## What are the main FastPubSub objects

The FastPubSub has two classes that are the backbone off an application: The `FastPubSub` and `PubSubBroker`. The `FastPubSub` object is the main entry point of your application. It is a FastAPI application, which means you can also use it to create REST APIs. The `PubSubBroker` is responsible for managing the connection with Google Pub/Sub and for handling subscribers and publishers. Every configuration related to PubSub will be attached to the broker instead of the `FastPubSub`. That means that you can use all FastAPI features like middlewares and lifespan with the application object while still integrating with the broker. For that, `FastPubSub` object takes a `PubSubBroker` instance as an argument. The broker is only the bridge between your application and Pub/Sub.

---
## Quick Start

Let's start with a simple example. Here is how you can create a basic FastPubSub application that subscribes to a topic, processes messages, and publishes a new message to another topic.


First, you need to install FastPubSub:

```bash
pip install fastpubsub
```

Now, create a file named `basic.py` with the following code:

```python
from pydantic import BaseModel, Field
from fastpubsub import FastPubSub, PubSubBroker, Message
from fastpubsub.logger import logger

class Address(BaseModel):
    street: str = Field(..., examples=["5th Avenue"])
    number: str = Field(..., examples=["1548"])


broker = PubSubBroker(project_id="some-project-id")
app = FastPubSub(broker)

@app.post("/addresses/")
async def create_address(address: Address):
    logger.info(f"Address received: {address}")
    await broker.publish(topic_name="in_topic", data=address)
    return {"message": "Address published"}

@broker.subscriber(
    alias="my_handler",
    topic_name="in_topic",
    subscription_name="sub_name",
)
async def handle_message(message: Message):
   logger.info(f"The message {message.id} arrived.")
   address = Address.model_validate_json(message.data)
   logger.info(f"Address: {address}")
```

Before running the application, you need to start the Google Pub/Sub emulator. You can do this using the `docker-compose.yaml` file below:

```yaml
services:
  pubsub:
    image: google/cloud-sdk:emulators
    command: gcloud beta emulators pubsub start --project fastpubsub-pubsub-local --host-port 0.0.0.0:8085
    environment:
      - CLOUDSDK_CORE_PROJECT=fastpubsub-pubsub-local
    volumes:
      - pubsub_data:/data
    ports:
      - "8085:8085"
    extra_hosts:
      - "localhost:host-gateway"

volumes:
  pubsub_data:
```

To start the emulator, navigate to the project root directory and run:

```bash
docker compose up -d pubsub
export PUBSUB_EMULATOR_HOST="localhost:8085"
```

To run the application, you can use the built-in **FastPubSub** CLI:

```bash
fastpubsub run basic:app
```

Now you can send a POST request to the `/addresses/` endpoint to publish a message. For example, using `curl`:

```bash
curl -X POST "http://127.0.0.1:8000/addresses/" -H "Content-Type: application/json" -d '{"street": "5th Avenue", "number": "1548"}'
```

You should see the following output in the application's logs:

```shell
2025-10-17 11:37:30,363 | INFO     | 85799:132569661355840 | runner:run:55 | FastPubSub app starting...
2025-10-17 11:37:30,650 | INFO     | 85799:132569661355840 | tasks:start:74 | The handle_message handler is waiting for messages.
2025-10-17 11:37:33,791 | INFO     | 85799:132569661355840 | basic:create_address:15 | Address received: street='5th Avenue' number='1548'
2025-10-17 11:37:33,821 | INFO     | 85799:132569661355840 | pubsub:publish:305 | Message published for topic projects/some-project-id/topics/in_topic with id 1
2025-10-17 11:37:33,832 | INFO     | 85799:132569661355840 | basic:handle_message:25 | The message 1 arrived. | name=handle_message message_id=1 topic_name=in_topic
2025-10-17 11:37:33,832 | INFO     | 85799:132569661355840 | basic:handle_message:27 | Address: street='5th Avenue' number='1548' | name=handle_message message_id=1 topic_name=in_topic
2025-10-17 11:37:33,851 | INFO     | 85799:132569661355840 | tasks:_consume:131 | Message successfully processed. | name=handle_message message_id=1 topic_name=in_topic
```

As you may notice the logs have lots of information about the the message consumption. You will see the `message_id`, `topic_name` and the handler `name` responsible for processing the messages. FastPubSub takes care of adding context to its own logs so all the useful information about the processing is included in it. This will be useful for tracking thing when they are not working properly, as we will discuss in the deployment section.


---

## Recap

In this tutorial, you have learned:

- What FastPubSub is and how it fits into the Google PubSub ecosystem.
- The two principal classes of an application  (`FastPubSub` and `PubSubBroker`) and what are their roles.
- How to create a simple FastPubSub application with a subscriber and a publisher.
- How to create a FastAPI endpoint to publish messages to a Pub/Sub topic.
